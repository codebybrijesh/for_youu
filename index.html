<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>For Sarshti ‚ú®</title>
    <style>
        body, html {
            margin: 0; padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
            font-family: 'Georgia', serif;
            overflow: hidden;
            text-align: center;
            
            /* --- FIXED BACKGROUND HERE --- */
            /* This ensures step3_bg.jpg is always the background */
            background: url('step3_bg.jpg') no-repeat center center fixed;
            background-size: cover; 
        }

        /* Overlay to darken the background slightly so text pops */
        .bg-overlay {
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0, 0, 0, 0.4); /* Darkens the background image by 40% */
            z-index: 1;
        }

        #container {
            background: rgba(255, 255, 255, 0.95); /* High opacity for readability */
            backdrop-filter: blur(5px);
            padding: 40px;
            border-radius: 30px;
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.2);
            max-width: 500px;
            width: 85%;
            z-index: 10;
            position: relative;
            transition: all 0.5s ease;
        }

        .step { display: none; animation: fadeIn 1s ease-in-out; }
        .active { display: block; }

        h2 { color: #ff4d6d; font-size: 1.8em; margin-bottom: 20px; }
        p { color: #333; line-height: 1.8; font-size: 1.1em; font-weight: 500; }

        .btn-next {
            background: #ff4d6d;
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            margin-top: 20px;
            font-size: 1em;
            transition: transform 0.2s;
        }
        .btn-next:hover { transform: scale(1.05); }

        /* Timeline Styles */
        .timeline {
            display: flex;
            overflow-x: auto;
            gap: 15px;
            padding: 20px 0;
            scrollbar-width: none;
        }
        .timeline-item {
            min-width: 200px;
            height: 250px;
            background: #eee;
            border-radius: 15px;
            overflow: hidden;
            flex-shrink: 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        .timeline-item img { width: 100%; height: 100%; object-fit: cover; }

        .game-container { position: relative; height: 150px; margin-top: 20px; }
        #yesBtn { background: #ff4d6d; color: white; border: none; padding: 15px 35px; border-radius: 50px; font-weight: bold; cursor: pointer; font-size: 1.2em; }
        #noBtn { background: #adb5bd; color: white; border: none; padding: 10px 20px; border-radius: 50px; position: absolute; cursor: pointer; white-space: nowrap; }

        .bouquet { font-size: 100px; margin-bottom: 10px; }

        /* NOTEBOOK TYPEWRITER EFFECT */
        .notebook-container {
            background: linear-gradient(180deg, #fef9e7 0%, #f5f0dc 100%);
            border: 2px solid #e0d8b0;
            border-radius: 15px;
            padding: 25px;
            margin: 15px 0;
            position: relative;
            overflow: hidden;
            box-shadow: inset 0 2px 8px rgba(0,0,0,0.05);
        }

        .notebook-lines {
            position: absolute;
            top: 0; left: 30px; right: 0; bottom: 0;
            background-image: 
                repeating-linear-gradient(
                    0deg,
                    transparent,
                    transparent 24px,
                    #e8e3d0 24px,
                    #e8e3d0 25px
                );
            pointer-events: none;
            z-index: 1;
        }

        .notebook-text {
            position: relative;
            z-index: 2;
            min-height: 120px;
            font-family: 'Georgia', serif;
            font-size: 1.1em;
            line-height: 1.8;
            color: #2c1810;
        }

        .typewriter-text {
            display: inline-block;
            border-right: 2px solid #4a2c0b;
            animation: blink-cursor 1s infinite;
            white-space: pre-wrap;
        }

        @keyframes blink-cursor {
            0%, 50% { border-right-color: #4a2c0b; }
            51%, 100% { border-right-color: transparent; }
        }

        .typewriter-complete {
            border-right: none !important;
            animation: none !important;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .floating-item { position: absolute; opacity: 0.3; z-index: 2; animation: float 8s infinite linear; pointer-events: none; color: white; text-shadow: 0 0 5px #ff4d6d; }
        @keyframes float { 0% { transform: translateY(0) rotate(0); } 100% { transform: translateY(-100vh) rotate(360deg); } }

        #canvas { display: none; position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 15; }
    </style>
</head>
<body>

    <audio id="bgMusic" loop><source src="ks.mp3" type="audio/mpeg"></audio>
    <audio id="successMusic"><source src="if.mp3" type="audio/mpeg"></audio>
    <audio id="finalMusic" loop><source src="final.mp3" type="audio/mpeg"></audio>

    <div class="bg-overlay"></div>
    <canvas id="canvas"></canvas>

    <div class="floating-item" style="left: 5%; bottom: 0; font-size: 40px;">üå∏</div>
    <div class="floating-item" style="left: 25%; bottom: -10%; font-size: 30px; animation-delay: 2s;">üìñ</div>
    <div class="floating-item" style="right: 15%; bottom: -20%; font-size: 50px; animation-delay: 4s;">üíù</div>
    <div class="floating-item" style="right: 5%; bottom: 0; font-size: 35px; animation-delay: 1s;">‚ú®</div>

    <div id="container">
        <div id="step1" class="step active">
            <h2>Hey Sarshti... ‚ú®</h2>
            <p>I‚Äôve built something special to tell you what's on my mind.<br>Before we start, make sure your volume is up! üéµ</p>
            <button class="btn-next" onclick="startExperience()">Open My Message</button>
        </div>

        <div id="step2" class="step">
            <h2 style="color: #ff4d6d;">The Impression...</h2>
            <div class="notebook-container">
                <div class="notebook-lines"></div>
                <div class="notebook-text">
                    <span class="typewriter-text" data-text="When I saw you at the wedding, I don‚Äôt know why, but my attention gently settled on you ‚Äî and your smile. In a room full of people, it was that one smile that stayed with me.

At first, I told myself this wasn‚Äôt something that should happen. When I later learned that you were elder than me, I paused and tried to understand what I was feeling. I didn‚Äôt want to rush it or misunderstand it.

Even though we haven‚Äôt met face to face since then, I felt a quiet curiosity to know you ‚Äî beyond just that moment. So we connected.

And slowly, through our conversations, I saw how warm, lively, and effortlessly graceful you are. Talking to you felt easy, comforting, and real.

When I came across your writings, your thoughts, and the way you express yourself, something deeper touched me. Your sensitivity, your values, and the clarity in your thinking made me admire you even more.

You are beautiful in a way that‚Äôs immediately noticeable, but it‚Äôs your intellect and thoughtfulness that leave a lasting impression.

I never realized the exact moment when my feelings changed. I just know that, somewhere along the way, admiration quietly became something more."></span>
                </div>
            </div>
            <button class="btn-next" onclick="nextStep(3)">Click to continue...</button>
        </div>

        <div id="step3" class="step">
            <h2 style="color: #ff4d6d;">Our Little World</h2>
            <div class="notebook-container">
                <div class="notebook-lines"></div>
                <div class="notebook-text">
                    <span class="typewriter-text" data-text="Even though there's a 4-year gap and we come from different worlds‚ÄîCommerce and B.Tech‚Äîour calls and chats have a 'balance' that no ledger could explain."></span>
                </div>
            </div>
            <button class="btn-next" onclick="nextStep(4)">See our journey...</button>
        </div>

        <div id="step4" class="step">
            <h2>Moments We Shared</h2>
            <p>Our chats, our calls, and these memories...</p>
            <div class="timeline">
                <div class="timeline-item"><img src="photo1.jpg" alt="Memory 1"></div>
                <div class="timeline-item"><img src="photo2.jpg" alt="Memory 2"></div>
                <div class="timeline-item"><img src="photo3.jpg" alt="Memory 3"></div>
            </div>
            <button class="btn-next" onclick="nextStep(5)">One more thing...</button>
        </div>

        <div id="step5" class="step">
            <h2>The Big Question</h2>
            <p>I want to upgrade our "connection" to the next version. Would you give this 1st-year student the honor of being your Valentine?</p>
            <div class="game-container">
                <button id="yesBtn" onclick="celebrate()">YES! ‚ù§Ô∏è</button>
                <button id="noBtn" onmouseover="moveNo()">No</button>
            </div>
        </div>

        <div id="step6" class="step">
            <div class="bouquet">üíê</div>
            <h2>I knew it! ‚ù§Ô∏è</h2>
            <p>The deal is finalized, Sarshti! üòâ</p>
            <p><b>When and where are we finally meeting for our date?</b></p>
            <button class="btn-next" onclick="showSurprise()">Click for one last surprise...</button>
        </div>
    </div>

    <script>
        let noCount = 0;
        const bgMusic = document.getElementById('bgMusic');
        const successMusic = document.getElementById('successMusic');
        const finalMusic = document.getElementById('finalMusic');
        const canvas = document.getElementById("canvas");
        const ctx = canvas.getContext("2d");

        // HEART TEXT MESSAGES
        const HEART_MESSAGES = [
            "I love you Sarshti ‚ù§Ô∏è",
            "Can you give me a chance? üíï", 
            "To, Ma'am Kya Vichaar hai üòâ"
        ];

        function startExperience() {
            bgMusic.play().catch(e => console.log("Music play blocked by browser until interaction"));
            nextStep(2);
        }

        function nextStep(stepNum) {
            // REMOVED: Logic that changes the background image. 
            // The background is now fixed in CSS.
            
            document.querySelectorAll('.step').forEach(step => step.classList.remove('active'));
            document.getElementById('step' + stepNum).classList.add('active');
            
            if (stepNum === 2 || stepNum === 3) {
                setTimeout(initTypewriter, 500);
            }
        }

        function celebrate() {
            bgMusic.pause();
            successMusic.play();
            nextStep(6);
            launchHearts();
        }

        function showSurprise() {
            successMusic.pause();
            finalMusic.play().catch(e => console.log(e));
            document.getElementById('container').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('container').style.display = 'none';
                canvas.style.display = 'block';
                initParticles();
                animateParticles();
            }, 1000);
        }

        function moveNo() {
            const noBtn = document.getElementById('noBtn');
            const x = Math.random() * (window.innerWidth - 150);
            const y = Math.random() * (window.innerHeight - 50);
            noBtn.style.position = 'fixed';
            noBtn.style.left = x + 'px'; noBtn.style.top = y + 'px';
            const messages = ["Think Again!!", "Don't test my Patience! üò§", "Yes is best ROI !!"];
            noBtn.innerText = messages[noCount % messages.length];
            noCount++;
        }

        // TYPEWRITER EFFECT
        function initTypewriter() {
            const typewriters = document.querySelectorAll('.typewriter-text[data-text]');
            typewriters.forEach((el, index) => {
                // Only run if not already completed
                if (!el.classList.contains('typewriter-complete') && el.textContent === "") {
                    setTimeout(() => {
                        typeWriter(el, el.getAttribute('data-text'), 0, 65);
                    }, index * 500);
                }
            });
        }

        function typeWriter(element, text, i, speed) {
            if (i < text.length) {
                element.textContent = text.substring(0, i + 1);
                setTimeout(() => typeWriter(element, text, i + 1, speed), speed + Math.random() * 20);
            } else {
                element.classList.add('typewriter-complete');
            }
        }

        // ENHANCED CYCLING PARTICLE ENGINE
        let particles = [];
        let currentMessageIndex = 0;
        const MESSAGES = [
            "I love you, Sarshti",
            "Can you give me a chance?", 
            "You are beautiful by heart"
        ];
        let cycleState = 'forming';
        let cycleTimer = 0;
        let textPixels = [];
        let exploded = false;
        const CYCLE_DURATION = 4000;

        window.addEventListener('mousedown', () => {
            exploded = true;
            cycleState = 'exploding';
            setTimeout(() => { exploded = false; }, 2500);
        });

        class Particle {
            constructor(targetX, targetY, isText = false) {
                this.x = Math.random() * canvas.width;
                this.y = Math.random() * canvas.height;
                this.baseX = targetX;
                this.baseY = targetY;
                this.vx = (Math.random() - 0.5) * 25;
                this.vy = (Math.random() - 0.5) * 25;
                this.acc = isText ? 0.15 : 0.08;
                this.friction = 0.92;
                this.size = isText ? Math.random() * 2 + 1.2 : Math.random() * 1 + 0.5;
                this.color = isText ? "#ffffff" : "#ff1a4d";
                this.isText = isText;
            }
            update() {
                if (exploded || cycleState === 'exploding') {
                    this.x += this.vx; this.y += this.vy;
                    this.vx *= this.friction; this.vy *= this.friction;
                } else {
                    let dx = this.baseX - this.x;
                    let dy = this.baseY - this.y;
                    this.x += dx * this.acc; this.y += dy * this.acc;
                    this.vx = (Math.random() - 0.5) * 30;
                    this.vy = (Math.random() - 0.5) * 30;
                }
                this.x += Math.sin(Date.now() * 0.002 + this.baseX) * 0.3;
                this.y += Math.cos(Date.now() * 0.002 + this.baseY) * 0.3;
            }
            draw() {
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fillStyle = this.color;
                if(this.isText) { ctx.shadowBlur = 15; ctx.shadowColor = "#ff80bf"; }
                else { ctx.shadowBlur = 2; ctx.shadowColor = "#ff1a4d"; }
                ctx.fill();
                ctx.shadowBlur = 0;
            }
        }

        function generateTextPixels(message) {
            const textCanvas = document.createElement('canvas');
            const tCtx = textCanvas.getContext('2d');
            textCanvas.width = canvas.width; textCanvas.height = canvas.height;
            tCtx.fillStyle = 'white';
            tCtx.font = '900 65px Arial'; 
            tCtx.textAlign = 'center';
            tCtx.textBaseline = 'middle';
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;
            tCtx.fillText(message, centerX, centerY);
            
            const pixels = tCtx.getImageData(0, 0, canvas.width, canvas.height).data;
            const targets = [];
            for (let y = 0; y < canvas.height; y += 3) {
                for (let x = 0; x < canvas.width; x += 3) {
                    if (pixels[(y * canvas.width + x) * 4] > 128) targets.push({x, y});
                }
            }
            return targets;
        }

        function initParticles() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            particles = [];
            const centerX = canvas.width / 2;
            const centerY = canvas.height / 2;

            textPixels = generateTextPixels(MESSAGES[currentMessageIndex]);
            const PARTICLE_COUNT = Math.min(8000, textPixels.length * 3);
            
            for (let i = 0; i < PARTICLE_COUNT; i++) {
                if (i < textPixels.length) {
                    particles.push(new Particle(textPixels[i].x, textPixels[i].y, true));
                } else {
                    const t = Math.random() * Math.PI * 2;
                    const r = 0.3 + Math.random() * 0.7; 
                    const x = 16 * Math.pow(Math.sin(t), 3);
                    const y = 13 * Math.cos(t) - 5 * Math.cos(2*t) - 2 * Math.cos(3*t) - Math.cos(4*t);
                    particles.push(new Particle(centerX + x * 18 * r, centerY - y * 18 * r, false));
                }
            }
            cycleState = 'forming';
            cycleTimer = 0;
        }

        function animateParticles() {
            ctx.fillStyle = "rgba(0, 0, 0, 0.25)"; 
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            if (!exploded) {
                cycleTimer++;
                if (cycleState === 'holding' && cycleTimer > CYCLE_DURATION) {
                    cycleState = 'exploding';
                    cycleTimer = 0;
                } else if (cycleState === 'exploding' && cycleTimer > CYCLE_DURATION / 2) {
                    currentMessageIndex = (currentMessageIndex + 1) % MESSAGES.length;
                    textPixels = generateTextPixels(MESSAGES[currentMessageIndex]);
                    particles.forEach((p, i) => {
                        if (i < textPixels.length) {
                            p.baseX = textPixels[i].x;
                            p.baseY = textPixels[i].y;
                            p.isText = true;
                        }
                    });
                    cycleState = 'forming';
                    cycleTimer = 0;
                } else if (cycleState === 'forming' && cycleTimer > CYCLE_DURATION * 1.5) {
                    cycleState = 'holding';
                    cycleTimer = 0;
                }
            }
            
            particles.forEach(p => { p.update(); p.draw(); });
            requestAnimationFrame(animateParticles);
        }

        // ENHANCED HEART ANIMATION WITH CHANGING TEXT
        function launchHearts() {
            for(let i = 0; i < 30; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    const messageIndex = Math.floor(Math.random() * HEART_MESSAGES.length);
                    heart.innerHTML = `<span style="font-size: 12px; line-height: 1.2; display: block; position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); white-space: nowrap; opacity: 0.9;">${HEART_MESSAGES[messageIndex]}</span>‚ù§Ô∏è`;
                    heart.style.cssText = `
                        position: fixed;
                        left: ${Math.random() * 100}vw;
                        top: 100vh;
                        font-size: 25px;
                        z-index: 100;
                        pointer-events: none;
                        transition: all 5s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                        transform: translateX(0, 0);
                        opacity: 1;
                    `;
                    document.body.appendChild(heart);
                    
                    // Animate up and fade
                    setTimeout(() => {
                        const randomX = (Math.random() - 0.5) * 200;
                        heart.style.transform = `translateY(-130vh) translateX(${randomX}px) rotate(${Math.random() * 20 - 10}deg) scale(1.2)`;
                        heart.style.opacity = '0';
                    }, 200 + i * 50);
                    
                    // Remove after animation
                    setTimeout(() => {
                        if (heart.parentNode) heart.remove();
                    }, 5200 + i * 50);
                }, i * 100);
            }
        }
    </script>
</body>
</html>
